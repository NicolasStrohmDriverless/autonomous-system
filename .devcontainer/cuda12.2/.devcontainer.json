// devcontainer.json
{
  "name": "Default",
  "remoteUser": "strohmo",
  "build": {
    "context": "../..",
    "dockerfile": "../../docker/Dockerfile.cuda12.2",
    "target": "default",
    "args": {
      "USERNAME": "strohmo",
      "UID": "1000",
      "GID": "1000"
    }
  },
  "workspaceFolder": "/home/strohmo/autonomous-system",
  "workspaceMount": "source=${localWorkspaceFolder},target=/home/strohmo/autonomous-system,type=bind",
  "mounts": [
    "type=bind,source=/dev/bus/usb,target=/dev/bus/usb"
  ],
  "runArgs": [
    "--gpus=all",
    "--net=host",
    "--privileged",
    "-e DISPLAY=host.docker.internal:0.0",
    "-e LIBGL_ALWAYS_INDIRECT=0",
    "--device-cgroup-rule=c 189:* rmw",
    "--cpus=8"   
  ],
  "customizations": {
    "vscode": {
      "extensions": [
        "ms-python.python",
        "ms-vscode.cpptools-extension-pack",
        "ms-iot.vscode-ros",
        "redhat.vscode-xml",
        "tamasfe.even-better-toml",
        "timonwong.shellcheck",
        "yzhang.markdown-all-in-one",
        "hediet.vscode-drawio",
        "twxs.cmake",
        "bierner.markdown-preview-github-styles",
        "ms-vscode.makefile-tools",
        "ms-vscode.cpptools",
        "ms-vscode.cpptools-themes",
        "ms-azuretools.vscode-docker",
        "matepek.vscode-catch2-test-adapter",
        "littlefoxteam.vscode-python-test-adapter",
        "usernamehw.errorlens",
        "streetsidesoftware.code-spell-checker",
        "streetsidesoftware.code-spell-checker-german",
        "SonarSource.sonarlint-vscode",
        "ms-vscode-remote.remote-wsl"
      ],
      "settings": {
        "hediet.vscode-drawio.theme": "atlas",
        "sonarlint.pathToCompileCommands": "${workspaceFolder}/build/compile_commands.json",
        "files.associations": {
          "*.rviz": "yaml",
          "*.srdf": "xml",
          "*.urdf": "xml",
          "*.xacro": "xml"
        },
        "cSpell.enableFiletypes": [
          "cmake",
          "dockerfile",
          "ros.msg",
          "shellscript",
          "xml"
        ],
        "cSpell.customDictionaries": {
          "project-words": {
            "name": "project-words",
            "path": "${workspaceFolder}/.devcontainer/project-words.txt",
            "description": "Words used in this project",
            "addWords": true
          }
        }
      }
    }
  },
  "features": {
    "ghcr.io/devcontainers/features/python:1": {
      "installTools": true,
      "version": "os-provided"
    }
  },
  "postCreateCommand": "rm -rf build/ install/ log/ && sudo chown -R strohmo ~/autonomous-system/ && rosdep update && rosdep install --from-paths src --ignore-src --rosdistro humble -y && colcon build --symlink-install --event-handlers console_direct+ --cmake-args -DCMAKE_BUILD_TYPE=Debug",
  "postStartCommand":  "cp src/drivers/depthai-ros/calibration/calibration.json /tmp/"
}
